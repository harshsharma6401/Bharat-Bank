<!DOCTYPE html>
<html lang="en">
  <%-include("./partials/head.ejs") %>

  <body class="form-bg">
    <%- include('./partials/nav.ejs') %>

    <head>
      <link rel="stylesheet" href="/forms.css" />
    </head>

    <div class="login-form-outer">
      <form class="form" onsubmit="return checkBeforeSubmit()">
        <div class="title">SignUp</div>
        <div class="subtitle">Let's SignUp for an Account!</div>
        <div class="input-container ic2">
          <input
            id="accountNumber"
            class="input"
            type="number"
            placeholder=" "
            name="accountNumber"
            autocomplete="off"
            required
          />
          <div class="cut cut-medium"></div>
          <label for="accountNumber" class="placeholder">Account Number</label>
        </div>
        <div class="input-container ic2">
          <input
            id="name"
            class="input"
            type="text"
            placeholder=" "
            name="Name"
            autocomplete="off"
            required
          />
          <div class="cut"></div>
          <label for="name" class="placeholder">Full Name</label>
        </div>

        <div class="input-container ic2">
          <input
            id="balance"
            class="input"
            type="number"
            placeholder=" "
            name="balance"
            autocomplete="off"
            required
          />
          <div class="cut"></div>
          <label for="balance" class="placeholder"> Balance </label>
        </div>

        <div class="input-container ic2">
          <input
            type="text"
            id="email"
            class="input"
            placeholder=" "
            name="email"
            autocomplete="off"
            required
          />
          <div class="cut"></div>
          <label for="email" class="placeholder">Email</label>
        </div>

        <div class="email error"></div>

        <div class="input-container ic2">
          <input
            type="text"
            id="password"
            class="input"
            placeholder=" "
            name="password"
            autocomplete="off"
            required
          />
          <div class="cut"></div>
          <label for="password" class="placeholder">Password</label>
        </div>

        <div class="password error"></div>

        <button type="text" class="submit">Submit</button>
      </form>
    </div>

    <script>
      $("#accountNumber").focusin(function () {
        $(this).attr("placeholder", "98XXXX (Will be autogenerated)");
      });

      $("#accountNumber").focusout(function () {
        $(this).attr("placeholder", " ");
      });

      const form = document.querySelector("form");
      const emailError = document.querySelector(".email.error");
      const passwordError = document.querySelector(".password.error");

      //get the values
      form.addEventListener("submit", async (e) => {
        e.preventDefault();

        //Reset errors
        emailError.textContent = "";
        passwordError.textContent = "";

        const email = form.email.value;
        const password = form.password.value;
        const accountNumber = Number(form.accountNumber.value);
        const name = form.name.value;
        const balance = Number(form.balance.value);

        console.log(email, password);

        try {
          const res = await fetch("/view-users", {
            method: "POST",
            body: JSON.stringify({
              accountNumber,
              name,
              balance,
              email,
              password,
            }),
            // Eqvivalaent to {email : email , password : password}
            headers: { "Content-type": "application/json" },
          });

          const data = await res.json();
          console.log("Data of add-user :", data);

          if (data.errors) {
            emailError.textContent = data.errors.email;
            passwordError.textContent = data.errors.password;
          }

          if (data.user) {
            location.assign("/dashboard");
          }
        } catch (err) {
          console.log("Error of add-user call in frontend : ", err);
        }
      });
    </script>
    <%- include('./partials/foot.ejs') %>
  </body>
</html>
